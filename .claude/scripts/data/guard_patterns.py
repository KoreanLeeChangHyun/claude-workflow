"""
guard_patterns.py - hooks 자기보호 가드용 패턴 정의

hooks_self_guard에서 사용하는 명령어 패턴을 정의합니다.
읽기 전용 명령어, 수정 명령어, 보호 경로, 인라인 쓰기 패턴의 4가지 카테고리로 구분합니다.
이 모듈은 순수 상수만 정의하며, 다른 모듈을 import하지 않는 leaf 모듈입니다.

카테고리:
    읽기 전용 패턴       - READONLY_PATTERNS (31개 항목)
    수정 명령어 패턴     - MODIFY_PATTERNS (24개 항목)
    보호 경로 패턴       - PROTECTED_PATH_PATTERNS (2개 항목)
    인라인 쓰기 패턴     - INLINE_WRITE_PATTERNS (7개 항목)
"""

# =============================================================================
# 읽기 전용 명령어 패턴 - 파일 시스템을 변경하지 않는 안전한 명령어
# =============================================================================
READONLY_PATTERNS = [
    "^\\s*git\\s",                                           # git 명령어
    "^\\s*python3?\\s",                                      # python/python3 실행
    "^\\s*node\\s",                                          # node 실행
    "^\\s*cat\\s",                                           # 파일 내용 출력
    "^\\s*ls\\b",                                            # 디렉토리 목록
    "^\\s*head\\s",                                          # 파일 앞부분 출력
    "^\\s*tail\\s",                                          # 파일 뒷부분 출력
    "^\\s*wc\\s",                                            # 단어/줄 수 카운트
    "^\\s*grep\\s",                                          # 텍스트 검색
    "^\\s*file\\s",                                          # 파일 타입 확인
    "^\\s*stat\\s",                                          # 파일 상태 확인
    "^\\s*diff\\s",                                          # 파일 비교
    "^\\s*bash\\s",                                          # bash 실행
    "^\\s*sh\\s",                                            # sh 실행
    "^\\s*source\\s",                                        # 스크립트 소싱
    "^\\s*\\.\\s",                                           # dot 소싱
    "^\\s*exec\\s",                                          # exec 실행
    "^\\s*env\\s",                                           # 환경변수 설정 실행
    "^(?:\\s*\\w+=\\S*\\s+)*(?:bash|sh|python3?|node)\\s",   # 환경변수 접두사 + 인터프리터
    "^\\s*\\.claude/hooks/.*\\.sh\\b",                       # hooks 스크립트 (상대경로)
    "^\\s*/.*/\\.claude/hooks/.*\\.sh\\b",                   # hooks 스크립트 (절대경로)
    "^\\s*less\\s",                                          # 페이지 단위 출력
    "^\\s*more\\s",                                          # 페이지 단위 출력
    "^\\s*find\\s",                                          # 파일 검색
    "^\\s*tree\\b",                                          # 디렉토리 트리 출력
    "^\\s*realpath\\s",                                      # 절대 경로 확인
    "^\\s*readlink\\s",                                      # 심볼릭 링크 확인
    "^\\s*sha256sum\\s",                                     # SHA-256 해시 계산
    "^\\s*md5sum\\s",                                        # MD5 해시 계산
    "^\\s*test\\s",                                          # 조건 테스트
    "^\\s*\\[\\s",                                           # 조건 테스트 (bracket)
]

# =============================================================================
# 수정 명령어 패턴 - 파일 시스템을 변경할 수 있는 명령어
# =============================================================================
MODIFY_PATTERNS = [
    "sed\\s+.*-i",       # sed 인플레이스 수정
    "sed\\s+-i",         # sed 인플레이스 수정 (짧은 형태)
    "\\bcp\\b",          # 파일 복사
    "\\bmv\\b",          # 파일 이동/이름 변경
    "echo\\s.*>\\s*",    # echo 리다이렉션 (덮어쓰기)
    "echo\\s.*>>\\s*",   # echo 리다이렉션 (추가)
    "printf\\s.*>\\s*",  # printf 리다이렉션 (덮어쓰기)
    "printf\\s.*>>\\s*", # printf 리다이렉션 (추가)
    "\\btee\\b",         # tee 출력 분기
    "cat\\s.*>\\s*",     # cat 리다이렉션 (덮어쓰기)
    "cat\\s.*>>\\s*",    # cat 리다이렉션 (추가)
    "\\bdd\\b",          # 블록 단위 복사
    "\\binstall\\b",     # 파일 설치
    "\\brsync\\b",       # 원격 동기화
    "\\bchmod\\b",       # 권한 변경
    "\\bchown\\b",       # 소유자 변경
    "ln\\s+-sf?\\b",     # 심볼릭 링크 생성
    "rm\\s+-rf?\\b",     # 파일/디렉토리 재귀 삭제
    "rm\\s+-f\\b",       # 파일 강제 삭제
    "\\btouch\\b",       # 파일 생성/타임스탬프 변경
    "\\bmkdir\\b",       # 디렉토리 생성
    "\\brmdir\\b",       # 디렉토리 삭제
    ">\\s*\\S",          # 리다이렉션 (덮어쓰기)
    ">>\\s*\\S",         # 리다이렉션 (추가)
]

# =============================================================================
# 보호 경로 패턴 - 수정이 차단되는 경로
# =============================================================================
PROTECTED_PATH_PATTERNS = [
    "\\.claude/hooks/",    # hooks 디렉토리
    "\\.workflow/bypass",  # 워크플로우 바이패스 파일
]

# =============================================================================
# 인라인 쓰기 패턴 - 스크립트 내부의 파일 쓰기 감지용
# =============================================================================
INLINE_WRITE_PATTERNS = [
    "open\\s*\\(",       # Python open()
    "write\\s*\\(",      # Python write()
    "writeFile",         # Node.js writeFile
    "writeFileSync",     # Node.js writeFileSync
    "appendFile",        # Node.js appendFile
    "appendFileSync",    # Node.js appendFileSync
    ">\\s*",             # Shell 리다이렉션
]
