# Clarification Rules (되묻기 규칙)

모든 에이전트가 쿼리 수행 전 반드시 따라야 하는 명확화 프로세스입니다.

> **AskUserQuestion 사용 원칙**
> - 사용자에게 질문, 확인, 재질의할 때는 **반드시 AskUserQuestion 도구를 사용**합니다.
> - 일반 텍스트 응답으로 질문하지 않습니다 (사용자가 응답할 수 없음).
> - AskUserQuestion은 선택지를 제공하여 사용자의 명시적 응답을 받는 유일한 방법입니다.
> - 이 문서의 모든 "되묻기", "확인", "질문" 동작은 AskUserQuestion 도구를 통해 수행됩니다.

## 되묻기 기준

### 1. 정보 부족 (Missing Information)
필수 정보가 누락된 경우 반드시 되물어야 합니다.

**체크리스트:**
- [ ] 작업 대상이 명확한가? (어떤 파일/모듈/기능?)
- [ ] 작업 범위가 정의되어 있는가? (어디까지?)
- [ ] 기대 결과가 명시되어 있는가? (무엇을 원하는가?)
- [ ] 필요한 입력값/파라미터가 있는가?

**되묻기 방법:** AskUserQuestion 도구를 사용하여 누락된 정보를 질문합니다.

**되묻기 예시 (AskUserQuestion 호출):**
```
AskUserQuestion(
  question="작업을 수행하기 전에 다음 정보가 필요합니다:\n\n1. **작업 대상**: 어떤 파일/모듈을 수정해야 하나요?\n2. **기대 결과**: 완료 후 어떤 동작을 기대하시나요?",
  options=["정보 제공 후 진행", "현재 정보로 진행", "작업 취소"]
)
```

### 2. 작업 과다 (Too Many Tasks)
단일 쿼리에 3개 이상의 독립적인 작업이 포함된 경우

**판단 기준:**
- 독립적으로 수행 가능한 작업이 3개 이상
- 각 작업이 서로 다른 파일/모듈에 영향
- 예상 작업 시간이 과도하게 길어질 것으로 판단

**되묻기 방법:** AskUserQuestion 도구를 사용하여 분할 방안을 제시하고 사용자 선택을 받습니다.

**되묻기 예시 (AskUserQuestion 호출):**
```
AskUserQuestion(
  question="요청에 4개의 독립 작업이 포함되어 있습니다:\n1. 사용자 인증 모듈 구현\n2. 데이터베이스 스키마 설계\n3. API 엔드포인트 작성\n4. 프론트엔드 폼 구현\n\n어떤 순서로 진행할까요?",
  options=["1→2→3→4 순서대로 진행", "우선순위를 직접 지정", "모두 한 번에 진행"]
)
```

### 3. 모호성 (Ambiguity)
요청이 여러 가지로 해석 가능한 경우

**판단 기준:**
- 용어가 프로젝트 내에서 여러 의미로 사용됨
- 구현 방식이 여러 가지 가능
- "좋게", "빠르게", "간단하게" 등 주관적 표현 사용

**되묻기 방법:** AskUserQuestion 도구를 사용하여 해석 옵션을 제시하고 사용자 선택을 받습니다.

**되묻기 예시 (AskUserQuestion 호출):**
```
AskUserQuestion(
  question="요청을 다음과 같이 해석할 수 있습니다. 어떤 방향으로 진행할까요?",
  options=[
    "A: 기존 로직을 수정하여 성능 개선",
    "B: 새로운 캐싱 레이어 추가",
    "C: 데이터베이스 쿼리 최적화"
  ]
)
```

## 되묻기 프로세스

```
┌─────────────────────────────────────┐
│           Query 수신                 │
└─────────────────┬───────────────────┘
                  ▼
┌─────────────────────────────────────┐
│        1. 정보 부족 체크              │
│   필수 정보가 모두 있는가?              │
└─────────────────┬───────────────────┘
                  │ No → 되묻기 (AskUserQuestion)
                  ▼ Yes
┌─────────────────────────────────────┐
│        2. 작업량 체크                 │
│   독립 작업이 3개 미만인가?             │
└─────────────────┬───────────────────┘
                  │ No → 분할 제안 (AskUserQuestion)
                  ▼ Yes
┌─────────────────────────────────────┐
│        3. 모호성 체크                 │
│   해석이 명확한가?                     │
└─────────────────┬───────────────────┘
                  │ No → 옵션 제시 (AskUserQuestion)
                  ▼ Yes
┌─────────────────────────────────────┐
│          작업 수행                   │
└─────────────────────────────────────┘
```

## 되묻기 응답 형식

되묻기는 반드시 **AskUserQuestion 도구**를 사용하여 수행합니다. 일반 텍스트로 질문하면 사용자가 응답할 수 없습니다.

**AskUserQuestion 호출 형식:**
```
AskUserQuestion(
  question="[상황 설명 + 확인이 필요한 사항]",
  options=["옵션 A: ...", "옵션 B: ...", "추가 정보 제공"]
)
```

**question 필드 구성 템플릿:**
```markdown
## [상황] - 추가 확인 필요

### 현재 이해한 내용
- [이해한 요청 내용 요약]

### 확인이 필요한 사항
1. [질문 1]
2. [질문 2]
```

**options 필드 가이드:**
- 2~5개의 선택지를 제공
- 각 선택지는 구체적이고 실행 가능한 내용
- 마지막 선택지에 "추가 정보 직접 입력" 포함 권장

## 되묻기 예외 상황

다음 경우에는 되묻지 않고 진행:
- 명시적으로 "일단 진행해" 라고 요청한 경우
- 이전 대화에서 이미 명확화된 내용
- 표준적인 방식이 명확한 간단한 작업
- 긴급 버그 수정 (단, 작업 후 확인 요청)

## 에이전트별 추가 규칙

> 모든 "확인" 동작은 AskUserQuestion 도구를 사용합니다.

### Coder
- 아키텍처 변경이 필요한 경우 AskUserQuestion으로 확인
- 기존 테스트에 영향을 줄 수 있는 경우 AskUserQuestion으로 확인

### Researcher
- 검색 범위가 불명확한 경우 AskUserQuestion으로 확인
- 결과 형식(요약/상세)이 불명확한 경우 AskUserQuestion으로 확인

### Tester
- 테스트 범위(단위/통합/E2E)가 불명확한 경우 AskUserQuestion으로 확인
- 테스트 환경이 특정되지 않은 경우 AskUserQuestion으로 확인

### Documenter
- 문서 대상 독자가 불명확한 경우 AskUserQuestion으로 확인
- 문서 형식/깊이가 불명확한 경우 AskUserQuestion으로 확인
