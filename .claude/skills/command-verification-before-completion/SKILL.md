---
name: command-verification-before-completion
description: "Enforces automated verification before declaring task completion. Requires running verification commands and confirming results before commits, PR creation, or task completion reports. Prevents unsubstantiated completion claims. Use for pre-completion verification: before task completion, before commits/PRs, before claiming success. Triggers: 'Done', 'Complete', '완료', '끝', 'PASS', '통과'."
license: "Apache-2.0"
---

# Verification Before Completion

## Overview

작업 완료를 선언하기 전 반드시 검증 명령어를 실행하고, 그 출력 결과를 확인하는 원칙.

**핵심 원칙:** 증거가 먼저, 주장은 그 다음.

**이 규칙의 글자를 위반하는 것은 정신을 위반하는 것이다.**

## The Iron Law

```
검증 증거 없이 완료를 주장하지 말 것
```

이 메시지에서 검증 명령어를 실행하지 않았다면, 통과했다고 주장할 수 없다.

## The Gate Function

```
상태 주장 또는 만족감 표현 전:

1. 식별: 이 주장을 증명하는 명령어는 무엇인가?
2. 실행: 전체 명령어를 실행 (최신, 완전)
3. 확인: 전체 출력 읽기, exit code 확인, 실패 수 카운트
4. 검증: 출력이 주장을 확인하는가?
   - 아니오: 증거와 함께 실제 상태를 보고
   - 예: 증거와 함께 주장
5. 그 다음에만: 주장을 수행

어떤 단계라도 건너뛰기 = 검증이 아닌 거짓
```

## Common Failures

| 주장 | 필요한 것 | 불충분한 것 |
|------|----------|------------|
| 테스트 통과 | 테스트 명령어 출력: 0 failures | 이전 실행, "통과할 것" |
| 린터 클린 | 린터 출력: 0 errors | 부분 체크, 추정 |
| 빌드 성공 | 빌드 명령어: exit 0 | 린터 통과, 로그 양호 |
| 버그 수정됨 | 원래 증상 테스트: 통과 | 코드 변경, 수정 추정 |
| 회귀 테스트 동작 | Red-Green 사이클 검증 | 테스트 1회 통과 |
| 에이전트 완료 | VCS diff에 변경 확인 | 에이전트 "성공" 보고 |
| 요구사항 충족 | 라인별 체크리스트 | 테스트 통과 |
| 회귀 없음 | 이전 검증 결과와 현재 결과 비교 테이블 | 이전 결과 참조 없이 현재만 확인 |

## Red Flags - STOP

- "~할 것이다", "아마", "~인 것 같다" 사용
- 검증 전 만족감 표현 ("좋아!", "완벽!", "끝!", "Done!" 등)
- 검증 없이 커밋/푸시/PR 생성 시도
- 에이전트 성공 보고를 신뢰
- 부분 검증에 의존
- "이번만" 사고
- 피로로 인한 작업 마무리 충동
- **검증 실행 없이 성공을 암시하는 모든 표현**

## Rationalization Prevention

| 변명 | 현실 |
|------|------|
| "이제 동작할 것" | 검증을 실행하라 |
| "확신한다" | 확신 != 증거 |
| "이번만" | 예외 없음 |
| "린터 통과했다" | 린터 != 컴파일러 |
| "에이전트가 성공이라 했다" | 독립적으로 검증하라 |
| "피곤하다" | 피로 != 면제 |
| "부분 체크면 충분하다" | 부분은 아무것도 증명하지 않는다 |

## Verification Result Table

검증 투명성을 확보하기 위해, Worker 작업 내역 파일에 **검증 결과 테이블**을 포함한다.

**원칙:** 모든 주장에는 검증 방법과 증거가 따라야 한다. 테이블 형식으로 기록하여 누락된 검증을 가시화한다.

**테이블 형식 (4컬럼):**

| 주장 | 검증 방법 | 결과 | 증거 |
|------|----------|------|------|
| 빌드 성공 | `npm run build` | PASS | exit code 0, 0 errors |
| 테스트 통과 | `npm test` | PASS | 42 passed, 0 failed |
| 린트 클린 | `npm run lint` | FAIL | 3 warnings, 1 error (line 45) |
| 타입 검사 통과 | `npx tsc --noEmit` | PASS | exit code 0 |

**컬럼 설명:**

- **주장**: 완료/성공으로 주장하는 내용 (예: "빌드 성공", "테스트 통과")
- **검증 방법**: 주장을 증명하기 위해 실행한 구체적 명령어
- **결과**: PASS / FAIL / SKIP (SKIP 사용 시 사유 필수)
- **증거**: 명령어 출력에서 추출한 구체적 수치 또는 핵심 출력

**Worker 작업 내역 포함 가이드:**

1. 작업 내역 파일(`work/WXX-*.md`)에 `## 검증 결과` 섹션을 추가
2. 해당 태스크에서 주장하는 모든 성공/완료 항목을 테이블에 나열
3. 검증 명령어를 실행하지 않은 항목은 테이블에 포함하지 않음 (주장 불가)
4. FAIL 항목이 있으면 대응 조치를 테이블 아래에 기술

**SKIP 허용 조건:**

- 해당 프로젝트에 검증 명령어가 존재하지 않는 경우 (예: 테스트 프레임워크 미설정)
- 스킬/문서 파일만 변경하여 빌드/테스트가 불필요한 경우
- SKIP 시 반드시 사유를 증거 컬럼에 기재

## Key Patterns

**테스트:**
```
OK: [테스트 명령어 실행] [결과: 34/34 pass] "전체 테스트 통과"
NG: "이제 통과할 것" / "맞아 보인다"
```

**회귀 테스트 (TDD Red-Green):**
```
OK: 작성 -> 실행(통과) -> 수정 되돌리기 -> 실행(반드시 실패) -> 복원 -> 실행(통과)
NG: "회귀 테스트를 작성했다" (red-green 검증 없이)
```

**빌드:**
```
OK: [빌드 실행] [결과: exit 0] "빌드 통과"
NG: "린터 통과했다" (린터는 컴파일을 체크하지 않는다)
```

**요구사항:**
```
OK: 계획 재확인 -> 체크리스트 생성 -> 각 항목 검증 -> 갭 또는 완료 보고
NG: "테스트 통과, 단계 완료"
```

**에이전트 위임:**
```
OK: 에이전트 성공 보고 -> VCS diff 확인 -> 변경 검증 -> 실제 상태 보고
NG: 에이전트 보고 신뢰
```

**검증 결과 테이블:**
```
OK: 테이블에 주장/검증방법/결과/증거 4컬럼 기록 -> FAIL 항목 대응 기술
NG: "검증 완료" (테이블 없이 구두 주장)
```

## Progressive Verification (점진적 검증)

implement-review 반복 사이클에서 이전 implement 결과와 현재 결과를 비교하여 회귀를 감지하는 메커니즘.

**핵심 원칙:** 현재 결과만으로는 개선을 증명할 수 없다. 이전 결과와의 비교가 있어야 회귀 여부를 판정할 수 있다.

**적용 시점:**
- implement 후 review에서 이슈가 발견되어 재 implement하는 경우
- 동일 검증 항목을 2회 이상 실행하는 경우
- 이전 워크플로우의 검증 결과가 존재하는 경우

**점진적 검증 테이블 형식 (5컬럼):**

| 검증 항목 | 이전 결과 | 현재 결과 | 변화 | 판정 |
|----------|----------|----------|------|------|
| 테스트 통과율 | 40/42 pass | 42/42 pass | +2 | 개선 |
| 린트 에러 | 3 errors | 0 errors | -3 | 개선 |
| 빌드 시간 | 12s | 45s | +33s | 회귀 |
| 타입 에러 | 0 errors | 0 errors | 0 | 유지 |

**컬럼 설명:**

- **검증 항목**: 검증 대상 (테스트, 린트, 빌드, 타입 검사 등)
- **이전 결과**: 직전 implement/review 사이클의 검증 결과 수치
- **현재 결과**: 이번 implement 후 검증 결과 수치
- **변화**: 이전 대비 수치 변화량 (양수/음수/0)
- **판정**: 회귀 / 개선 / 유지 중 하나

**판정 기준:**

| 판정 | 조건 | 대응 |
|------|------|------|
| 개선 | 현재 결과가 이전보다 나아짐 | 계속 진행 |
| 유지 | 이전과 동일 | 계속 진행 |
| 회귀 | 현재 결과가 이전보다 나빠짐 | 즉시 원인 분석 후 수정 필수 |

**회귀 발견 시 프로토콜:**

1. 회귀 항목을 즉시 식별하고 원인을 분석
2. 회귀를 수정한 후 전체 검증을 재실행
3. 점진적 검증 테이블을 갱신하여 모든 항목이 "개선" 또는 "유지"인지 확인
4. 회귀 항목이 남아 있으면 완료를 선언할 수 없음

**이전 결과 참조 방법:**

- 선행 태스크의 작업 내역 파일(`work/WXX-*.md`)에서 `## 검증 결과` 테이블을 확인
- 동일 워크플로우 내 이전 implement 사이클의 검증 출력을 참조
- 이전 결과가 존재하지 않는 최초 실행 시, "이전 결과" 컬럼에 "N/A (최초 실행)"을 기재

## When To Apply

**반드시 적용:**
- 성공/완료 주장의 모든 변형 전
- 만족감 표현 전
- 작업 상태에 대한 모든 긍정적 진술 전
- 커밋, PR 생성, 태스크 완료 전
- 다음 태스크 이동 전
- 에이전트 위임 전

## The Bottom Line

**검증에 지름길은 없다.**

명령어를 실행하라. 출력을 읽어라. 그 다음에 결과를 주장하라.

이것은 타협의 대상이 아니다.
